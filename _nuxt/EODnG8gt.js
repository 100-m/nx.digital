import P from"./By2t22F3.js";import U from"./gFbj9LAa.js";import{f as E,r as L,p as B,h as C,w as f,o as p,b as y,i as u,B as M,a as h,c as d,F as w,v as k,d as z,t as b,P as V,k as I,j as R,m as W}from"./BPRHiPFR.js";import{_ as J}from"./3i7_2xzH.js";import{_ as T}from"./CtvC2g-e.js";import{f as x}from"./Dx4HipMo.js";import{u as Z}from"./5aBfFGo0.js";import"./BIx12qXI.js";import"./qhOtPnIg.js";const G={class:"ml-1 flex !h-7 items-center"},H=["onClick"],K={class:"truncate"},Q=["onClick"],X=["onClick"],Y=["onClick"],ee={class:"truncate"},te={key:2,"nx-cell":"",class:"flex w-full items-center gap-2 px-2 font-medium"},ne={key:0},fe=E({__name:"3-documents",setup(oe){const{data:g}=Z("files"),v=L(null),j=B(()=>{const e=`${$route.query.path||""}`;e.endsWith("/")&&$router.replace({query:{path:e.slice(0,-1)}});const n=e.split("/").slice(1),o=e.split("/").map((r,s,t,i=t.slice(0,s+1).join("/"))=>Object.entries(g.value.filter(l=>l.path.startsWith(i+"/")).map(l=>({...l,name:+(l.path.replace(i,"").split("/").length===2)+l.path.replace(i,"").split("/")[1]})).group("name")).sort(0)),a=Array.from({length:Math.max(...o.map(r=>r.length))}).map((r,s)=>{const t=Object.fromEntries(n.map((se,N)=>{var S;return[`p${N}`,((S=o[N][s])==null?void 0:S[0])??""]})),i=o.at(-1)[s];if(!i)return{...t,id:s,name:"",modified:"",size:"",run:""};const[l,m]=i,$=l[0]==="0",_=l.slice(1);return{...t,id:e+"/"+_,name:_,modified:new Date(m.map("modified").min()).format(),size:$?`${m.length} file${m.length>1?"s":""} - ${(m.sum("size")/1.024).format(2)}b`.replace("1 file - 0b","empty"):`${(m.sum("size")/1.024).format(2)}b`,run:$?"-":m[0].runId}}).filter(r=>r.name!=="<empty>"),c={showCheckbox:!1,enableItemSelection:!1,actions:["slot-path"],columns:[...n.map((r,s)=>({key:`p${s}`,label:" ".repeat(s),width:240})),{key:"name",label:"Name",width:240},{key:"modified",label:"Modified",width:100},{key:"size",label:"Size",width:100},{key:"run",label:"Run",width:100}]};return setTimeout(()=>{v.value.columns.setFreezedCount(0),v.value.scroll.setLeft(1e4)},100),{data:a,options:c}}),A=B(()=>`Documents${$route.query.path||""}`.split("/").map((e,n,o)=>({label:e,to:{query:{path:`/${o.slice(1,n+1).join("/")}`.replace(/^\/$/,"")}}})));function O(e){$router.push({query:{path:e.split("/").slice(0,-1).join("/")}})}function q(e,n){const o=e[0]==="0",a=e.slice(1);let c=$route.query.path??"";const r=!o||c.split("/").find(s=>s===a);return n&&(c=c.split("/").slice(0,n).join("/")),$router.push({query:{path:r?c:`${c}/${a}`}})}function D(e){const n=["pdf","xls","doc","zip","csv","gpg","docx","xlsx","html"],o=e.lastIndexOf(".");if(o>-1){const a=e.substring(o+1);return n.includes(a.toLowerCase())}return!1}async function F(e){const n=D(e),o=g.value.filter(t=>t.path.startsWith(e)&&!n||t.path===e).map(t=>"/impress/commandr"+t.path);let a=e.split("/").at(-1);const c=o[0]==="/impress/commandr"+e&&o.length===1;if(!o.length)return;let r;if(c)r=await(await fetch(o[0])).blob();else{window.JSZip||await"https://cdn.jsdelivr.net/npm/jszip".inject();const t=new window.JSZip;for(const i of o){const l=i.indexOf(e),m=a+i.substring(l+e.length);t.file(m,await(await fetch(i)).blob())}r=await t.generateAsync({type:"blob"}),a.endsWith(".zip")||(a=a+".zip")}const s=document.createElement("a");s.setAttribute("href",URL.createObjectURL(r)),s.setAttribute("style","display: none;"),s.setAttribute("download",a),document.body.appendChild(s),s.click()}return(e,n)=>{const o=P,a=U,c=W,r=J,s=T;return p(),C(s,null,{search:f(()=>[y(o,{class:"w-full md:w-[320px] md:flex-initial lg:w-1/2",size:"lg",icon:"i-carbon/search",color:"white",placeholder:e.t.search,options:u(g).map("path"),popper:{offsetDistance:-35},searchable:"",onChange:O},null,8,["placeholder","options"])]),default:f(()=>[(p(),C(r,M({class:"h-full min-h-[400px] rounded shadow"},u(j),{key:u(j).options.columns.length,onState:n[2]||(n[2]=t=>v.value=t)}),{"slot-path":f(()=>[h("div",G,[y(a,{links:u(A)},null,8,["links"])])]),cell:f(({cell:t,header:i,row:l,view:m,isItemHover:$})=>[/^ *$/.test(i.label)?(p(),d("div",{key:0,"nx-cell":"",class:k(["group flex h-full w-full cursor-pointer items-center gap-2 px-2 font-medium",t.slice(1)&&(e._.provides[V]||e.$route).query.path.includes(t.slice(1))&&"bg-primary-100"]),onClick:_=>q(t,i.label.length+1)},[t[0]==="0"?(p(),d(w,{key:0},[h("div",{class:k(["-mr-2 shrink-0 text-xl",("fileIcon"in e?e.fileIcon:u(x))("/")])},null,2),y(c,{class:"group-hover:text-primary text-stone-900",variant:"link"},{default:f(()=>[z(b(t.slice(1)),1)]),_:2},1024)],64)):(p(),d(w,{key:1},[h("div",{class:k(["shrink-0 text-xl",("fileIcon"in e?e.fileIcon:u(x))(t.slice(1))])},null,2),h("div",K,b(t.slice(1)),1)],64))],10,H)):I("",!0),i.label==="Name"?(p(),d("div",{key:1,"nx-cell":"",class:"group flex h-full w-full cursor-pointer items-center gap-2 px-2 font-medium",onClick:_=>q((l.Run==="-"?"0":"1")+t)},[l.Run==="-"?(p(),d(w,{key:0},[h("div",{class:k(["-mr-2 shrink-0 cursor-pointer text-xl",("fileIcon"in e?e.fileIcon:u(x))("/")]),tooltip:"download",onPointerdown:n[0]||(n[0]=R(()=>{},["stop"])),onClick:_=>F(l.id)},null,42,X),y(c,{class:"group-hover:text-primary text-stone-900",variant:"link"},{default:f(()=>[z(b(t),1)]),_:2},1024)],64)):(p(),d(w,{key:1},[h("div",{class:k(["shrink-0 cursor-pointer text-xl",("fileIcon"in e?e.fileIcon:u(x))(t)]),tooltip:"download",onPointerdown:n[1]||(n[1]=R(()=>{},["stop"])),onClick:_=>F(l.id)},null,42,Y),h("div",ee,b(t),1)],64))],8,Q)):I("",!0),i.label==="Run"?(p(),d("div",te,[!t||t==="-"?(p(),d("div",ne,b(t),1)):(p(),C(c,{key:1,to:"/run/"+t,color:"amber",size:"2xs",tooltip:e.t.details},{default:f(()=>[z(b(t),1)]),_:2},1032,["to","tooltip"]))])):I("",!0)]),_:1},16))]),_:1})}}});export{fe as default};
