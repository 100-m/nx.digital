import{f as U,o,c as i,b as B,k as b,h as D,w as H,a as e,t as c,i as l,l as W,m as F,p as M,r as P,F as z,q as A,s as v,v as O,x as G,y as J,d as K,z as Q,P as X}from"./BJUyEi7U.js";import Z from"./DumxBdTx.js";import{u as Y,a as L}from"./CUvU4tPK.js";import{s as E,a as S}from"./qhOtPnIg.js";import{f as V}from"./Dx4HipMo.js";import{_ as ee,a as te}from"./TCbTYIN0.js";import{_ as se}from"./CiweJmm9.js";const ne={class:"flex items-center gap-1"},oe=["tooltip"],ae={class:"truncate"},le=U({__name:"im-user",props:{data:{},nouser:{type:Boolean},noselect:{type:Boolean}},setup(T){const{data:$}=Y("users");return(p,h)=>{const u=W,m=F,_=Z;return o(),i("div",ne,[!p.nouser&&p.data?(o(),i("div",{key:0,tooltip:p.data},[B(u,{alt:p.data,size:"2xs",class:"pointer-events-none bg-stone-400"},null,8,["alt"])],8,oe)):b("",!0),p.noselect?b("",!0):(o(),D(_,{key:1,uiMenu:{width:"w-[210px]"},variant:"none",size:"2xs",searchable:"",searchAttributes:["username","email"],by:"username",options:l($),disabled:!("alfred"in p?p.alfred:l(L)).can("run_assign")},{option:H(({option:s})=>[e("span",ae,c(s.username),1)]),default:H(()=>[B(m,{icon:"i-carbon/user",size:"2xs",color:"primary",variant:"outline",square:"",tooltip:p.t.assign},null,8,["tooltip"])]),_:1},8,["options","disabled"]))])}}}),ie={class:"flex h-auto max-h-full flex-col overflow-hidden"},re={class:"text-md mb-3 flex-none font-bold"},de={class:"h-full flex-1 overflow-y-auto"},ce=["onClick"],ue={class:"flex w-full p-4"},pe={class:"flex w-full flex-col gap-2"},fe={class:"flex items-center gap-x-2 font-medium"},me={class:"text-sm font-medium truncate"},_e={class:"flex w-full max-w-full items-center gap-2"},he={class:"flex items-center gap-1"},xe=["tooltip"],ve=["tooltip"],be=["tooltip"],ge=["tooltip"],we=["tooltip"],ye=["tooltip"],$e={key:0,class:"ml-auto flex justify-end flex-none gap-1 w-auto"},ke=["innerHTML"],Te={key:1,class:"flex items-start space-x-3 rounded-b border-t border-stone-200 px-4 py-2 focus-within:ring-1"},De={class:"flex flex-1 gap-x-1"},Ie={class:"flex flex-none flex-col"},Me=["tooltip","disabled"],Le={key:0,class:"ml-7 h-[14px] w-px bg-stone-500"},Be=U({__name:"im-steps",props:{data:{}},setup(T){const $=T,p=M(()=>$.data.workflow.steps),h=M(()=>$.data.logs),u=P(0),m=P(""),_=s=>S.filter(a=>L.support(a.name,$.data,s)).length;return(s,a)=>{const w=le,d=F;return o(),i("div",ie,[e("h2",re,c(s.t.steps),1),e("div",de,[(o(!0),i(z,null,A(l(p),(n,f)=>{var y,g,k,r,I,C,N,R,j,q;return o(),i("div",{key:`step-${f}`},[e("div",{class:v(["rounded border bg-white",l(u)===f?"border-blue-400":"cursor-pointer border-stone-200"]),onClick:x=>u.value=f},[e("div",ue,[e("div",pe,[e("div",fe,[e("div",{class:v(["flex h-5 w-5 flex-none items-center justify-center rounded-full ring-inset text-xs font-bold",l(u)===f?"ring-2 ring-blue-400":"ring-2 ring-stone-200"])},c(n.id),3),l(h).length?(o(),i("div",{key:0,class:v(["h-3.5 w-3.5 flex-none rounded-sm",l(h).find(x=>x.stepId===n.id)?(y=("statusClasses"in s?s.statusClasses:l(E))[l(h).find(x=>x.stepId===n.id).status])==null?void 0:y.bg:"bg-stone-200"])},null,2)):b("",!0),e("span",me,c(n.name),1)]),e("div",_e,[e("div",he,[e("div",{class:v([(g=n.conditions)!=null&&g.length?"bg-primary-100":"bg-stone-50","p-1 self-center h-6 rounded-full"]),tooltip:s.t.condition},[e("span",{class:v(["i-carbon/operation-if h-4 w-4",(k=n.conditions)!=null&&k.length?"text-primary-700":"text-stone-800"])},null,2)],10,xe),e("div",{class:v([n.event?"bg-primary-100":"bg-stone-50","p-1 self-center h-6 rounded-full"]),tooltip:s.t.event},[e("span",{class:v(["i-carbon/event-schedule h-4 w-4",n.event?"text-primary-700":"text-stone-800"])},null,2)],10,ve),e("div",{class:v([(r=n.waitFor)!=null&&r.length?"bg-primary-100":"bg-stone-50","p-1 self-center h-6 rounded-full"]),tooltip:s.t.wait_for},[e("span",{class:v(["i-carbon/container-image-pull h-4 w-4",(I=n.waitFor)!=null&&I.length?"text-primary-700":"text-stone-800"])},null,2)],10,be),e("div",{class:v([n.isBlocking?"bg-red-100":"bg-stone-50","p-1 self-center h-6 rounded-full"]),tooltip:s.t.blocking},[e("span",{class:v(["i-carbon/stop-filled-alt h-4 w-4",n.isBlocking?"text-red-700":"text-stone-800"])},null,2)],10,ge),e("div",{class:v([n.isResolving?"bg-amber-100":"bg-stone-50","p-1 self-center h-6 rounded-full"]),tooltip:s.t.resolving},[e("span",{class:v(["i-carbon/merge h-4 w-4",n.isResolving?"text-amber-700":"text-stone-800"])},null,2)],10,we),(C=n.command)!=null&&C.length||_(n.id)?(o(),i("div",{key:0,class:v([(N=n.command)!=null&&N.length||_(n.id)?"bg-primary-100":"bg-stone-50","p-1 self-center h-6 rounded-full"])},[e("span",{class:v(["h-4 w-4",(R=n.command)!=null&&R.length?"i-carbon/bot":"i-carbon/user"]),tooltip:(j=n.command)!=null&&j.length?s.t.command:s.t.user_action},null,10,ye)],2)):b("",!0),(q=l(h).find(x=>x.stepId===n.id))!=null&&q.assignee?(o(),D(w,{key:1,noselect:"",data:l(h).find(x=>x.stepId===n.id).assignee},null,8,["data"])):b("",!0)]),_(n.id)?(o(),i("div",$e,[(o(!0),i(z,null,A("stepActions"in s?s.stepActions:l(S),x=>(o(),i(z,null,[("alfred"in s?s.alfred:l(L)).support(x.name,s.data,n.id)?(o(),D(d,{key:0,icon:x.icon,color:x.color,size:"2xs",variant:"solid",square:"",tooltip:x.tooltip,disabled:!("alfred"in s?s.alfred:l(L)).can(x.name),onPointerdown:Tt=>("alfred"in s?s.alfred:l(L)).functions[x.name](s.data,n.id)},null,8,["icon","color","tooltip","disabled","onPointerdown"])):b("",!0)],64))),256))])):b("",!0)])])]),l(u)===f&&n.instruction?(o(),i("p",{key:0,class:"border-t px-4 py-2 text-sm",innerHTML:n.instruction.replace(/(?:\\[rn]|[\r\n])/g,"<br>")},null,8,ke)):b("",!0),l(u)===f?(o(),i("div",Te,[e("div",De,[a[3]||(a[3]=e("label",{for:"comment",class:"sr-only"},"Write your comment",-1)),O(e("textarea",{"onUpdate:modelValue":a[0]||(a[0]=x=>J(m)?m.value=x:null),rows:"2",name:"comment",id:"comment",class:"w-full resize-none appearance-none border-0 p-0 text-stone-900 shadow-none outline-none placeholder:text-stone-400 focus:ring-0 sm:text-sm sm:leading-6",placeholder:"Write your comment..."},null,512),[[G,l(m)]]),e("div",Ie,[B(d,{variant:"ghost",icon:"i-lucide/send-horizontal",size:"xs",color:"white",tooltip:s.t.send},null,8,["tooltip"]),l(p)[l(u)].name==="Edit and validate report"?(o(),i("label",{key:0,class:"hover:text-primary-500 focus-visible:ring-primary-500 dark:focus-visible:ring-primary-400 inline-flex flex-shrink-0 items-center gap-x-1.5 rounded p-1.5 text-xs font-medium text-stone-400 hover:bg-white focus:outline-none focus-visible:outline-0 focus-visible:ring-2 focus-visible:ring-inset disabled:cursor-not-allowed disabled:text-stone-300 disabled:opacity-75 dark:text-white dark:hover:bg-stone-900",tooltip:l(p)[l(u)].name,disabled:!("alfred"in s?s.alfred:l(L)).can("run_upload")},[a[2]||(a[2]=e("span",{class:"i-lucide/paperclip h-4 w-4 flex-shrink-0","aria-hidden":"true"},null,-1)),e("input",{id:"file",type:"file",accept:".doc,.docx",class:"hidden",onInput:a[1]||(a[1]=x=>("alfred"in s?s.alfred:l(L)).functions.run_upload(s.data,x.target))},null,32)],8,Me)):b("",!0)])])])):b("",!0)],10,ce),f+1!==l(p).length?(o(),i("div",Le)):b("",!0)])}),128))])])}}}),He={class:"flex h-fit max-h-full flex-col overflow-hidden"},ze={class:"text-md mb-3 flex-none font-bold"},Ce={class:"h-full w-full flex-1 overflow-y-auto rounded border bg-white"},Ae={class:"flex gap-x-1 px-4 py-3 odd:bg-white even:bg-stone-100"},Ue={class:"line-clamp-4 flex-1 text-sm"},Fe=["innerHTML"],Ne={key:1},Re={class:"mb-1 text-xs font-medium"},je={class:"flex gap-2"},qe={class:"flex flex-none flex-col items-center gap-1"},Pe={class:"flex h-5 w-5 flex-none items-center justify-center rounded-full border border-stone-200 text-xs"},Se=["tooltip"],Ve=U({__name:"im-traces",props:{data:{}},setup(T){const $=T,p=M(()=>[...$.data.logs.map(s=>({log:s,type:"log",date:s.start,step:s.stepId}))].sort(s=>s.date?-new Date(s.date).getTime():new Date().getTime()));function h(m){var f;const a=$.data.workflow.steps.find(y=>y.id===m.stepId).name,w=m.status,d=(f=E[w])==null?void 0:f.text;let n;return m.end&&(n=(new Date(m.end).getTime()-new Date(m.start).getTime()).duration()),n?`<span><b>${a}</b> ${t.ended_with} <span class="${d} font-medium">${w}</span> ${t.after} <b>${n}</b></span>`:["running","killed"].includes(m.status)?`<span><b>${a}</b> is <span class="${d} font-medium">${w}</span></span>`:`<span><b>${a}</b> ${t.ended_with} <span class="${d} font-medium">${w}</span></span>`}function u(m,_=new Date){if(!_||!m)return"";const s=_.getTime()-new Date(m).getTime(),a=[315576e5,26298e5,6048e5,864e5,36e5,6e4,1e3,1],w=a.findIndex(d=>d<=Math.abs(s));return Math.round(s/a[w])+["y","m","w","d","h","min","sec","ms"][w]}return(m,_)=>(o(),i("div",He,[e("h2",ze,c(m.t.traces),1),e("div",Ce,[(o(!0),i(z,null,A(l(p),s=>{var a;return o(),i("div",Ae,[e("div",Ue,[s.type==="log"?(o(),i("div",{key:0,innerHTML:h(s.log)},null,8,Fe)):s.type==="comment"?(o(),i("div",Ne,[e("div",Re,c(s.comment.user),1),e("div",je,[_[0]||(_[0]=e("span",{class:"i-carbon/quotes mt-1 h-3 w-3 flex-none"},null,-1)),e("div",null,c(s.comment.text),1),_[1]||(_[1]=e("span",{class:"i-carbon/quotes mt-1 h-3 w-3 flex-none"},null,-1))])])):b("",!0)]),e("div",qe,[e("div",Pe,c(s.step),1),e("span",{class:"text-xs text-stone-500",tooltip:(a=s.date)==null?void 0:a.format("YYYY-MM-DD hh:mm")},c(u(s.date)),9,Se)])])}),256))])]))}}),Ye={class:"flex h-full @[1000px]:h-fit max-h-full flex-col overflow-hidden"},Ee={class:"text-md mb-3 flex-none font-bold"},We={class:"h-full w-full flex-1 overflow-y-auto rounded border bg-white"},Oe={class:"flex flex-col gap-5"},Ge={class:"border-b-2 px-4 py-1 text-base font-bold"},Je={class:"hover:bg-primary-50 cursor-pointer transition odd:bg-white even:bg-stone-100"},Ke={key:0,class:"relative flex items-center gap-2 px-4 py-1.5 text-sm"},Qe={class:"flex h-5 w-5 flex-none items-center justify-center rounded-full border border-stone-200 text-xs"},Xe={class:"truncate"},Ze={class:"ml-auto text-xs"},et=["tooltip"],tt={key:1,class:"relative flex items-center gap-2 px-4 py-1.5 text-sm"},st={class:"truncate"},nt={class:"ml-auto text-xs font-semibold whitespace-nowrap"},ot={class:"truncate"},at=["href"],lt={class:"truncate"},it={class:"ml-auto text-xs font-semibold whitespace-nowrap"},rt={class:"truncate"},dt={class:"sr-only"},ct=U({__name:"im-work",props:{data:{}},setup(T){const p=T.data,h=p.logs,u=p.workflow,m=M(()=>h.flatMap(d=>d.files?d.files.map(n=>({file:n,stepId:d.stepId})):[])),_=M(()=>u.steps.flatMap(d=>d.waitFor?d.waitFor.map(n=>({label:n,stepId:d.id})):[])),s=M(()=>{const d=()=>{const f=[],y=k=>{const r=(u.steps.find(I=>I.event===k)||{}).id;return!r||!h||!h.length?"":(h.findLast(I=>I.stepId===r)||{}).end||""},g=k=>{const r=(u.steps.find(C=>C.event===k)||{}).name,I=(u.steps.find(C=>C.event===k)||{}).id;return{stepName:r,stepId:I}};return y("auditor_due_date"),y("calc_due_date"),y("dissemination_due_date"),g("date_auditor_validation"),g("date_calc"),g("date_diffusion"),y("date_internal_validation"),f.filter(k=>k.label)};return[{title:t.wait_for,type:"eventsDependencies",items:_.value},{title:"SLA",type:"sla",items:d()},{title:t.previews,type:"file",items:m.value}].filter(f=>f.items.length)});function a(d,n){let f=0;return!n&&n===""?(n=new Date,f=Math.sign(n.getTime()-new Date(d).getTime())):f=Math.sign(new Date(n).getTime()-new Date(d).getTime()),{1:"text-red-400",0:"text-stone-400","-1":"text-green-400"}[f]}function w(d,n){const f=new Date(n||new Date).getTime()-new Date(d||new Date).getTime(),y=[315576e5,26298e5,6048e5,864e5,36e5,6e4,1e3,1],g=y.findIndex(r=>r<=Math.abs(f));return(f>0?"+":"")+Math.round(f/y[g])+["y","m","w","d","h","min","sec","ms"][g]}return(d,n)=>{const f=Q,y=F;return o(),i("div",Ye,[e("h2",Ee,c(d.t.work_in_progress),1),e("div",We,[e("div",Oe,[(o(!0),i(z,null,A(l(s),(g,k)=>(o(),i("section",null,[e("h3",Ge,c(g.title),1),(o(!0),i(z,null,A(g.items,r=>(o(),i("div",Je,[g.type==="sla"?(o(),i("div",Ke,[e("div",Qe,c(r.stepId),1),e("div",Xe,c(r.label),1),e("div",Ze,c(new Date(r.deadline).format("day, mon",d.$ctx.lang)),1),e("div",{class:v(["-ml-1 w-6 text-xs",a(r.deadline,r.effective)]),tooltip:r.deadline},c(w(r.deadline,r.effective)),11,et)])):g.type==="eventsDependencies"?(o(),i("div",tt,[e("div",st,c(r.label),1),e("div",nt,c(d.t.step)+" "+c(r.stepId),1)])):g.type==="file"&&r.file.path.endsWith("/")?(o(),D(f,{key:2,class:"relative flex items-center gap-2 px-4 py-1.5 text-sm",to:`/documents?path=${r.file.path}`},{default:H(()=>[e("div",{class:v(["h-5 w-5 flex-none",("fileIcon"in d?d.fileIcon:l(V))(r.file.path)])},null,2),e("div",ot,c(r.file.path.split("/").filter().at(-1)),1)]),_:2},1032,["to"])):g.type==="file"?(o(),i("a",{key:3,class:"relative flex items-center gap-2 px-4 py-1.5 text-sm",href:`/impress/commandr${r.file.path}`,download:""},[e("div",{class:v(["h-5 w-5 flex-none",("fileIcon"in d?d.fileIcon:l(V))(r.file.path)])},null,2),e("div",lt,c(r.file.path.split("/").filter().at(-1)),1),e("div",it,c(d.t.step)+" "+c(r.stepId),1)],8,at)):g.type==="dependency"?(o(),D(f,{key:4,class:"relative flex items-center gap-2 px-4 py-1.5 text-sm",to:r.url},{default:H(()=>[r.runId?(o(),D(y,{key:0,color:"amber",size:"2xs",tooltip:d.t.details},{default:H(()=>[K(c(r.runId),1)]),_:2},1032,["tooltip"])):b("",!0),e("div",rt,c(r.label),1),r.runType?(o(),i("div",{key:1,class:v(["ml-auto",r.runType==="up"?"i-carbon/mac-shift":"i-carbon/arrow-shift-down"])},[e("span",dt,c(r.runType),1)],2)):b("",!0)]),_:2},1032,["to"])):b("",!0)]))),256))]))),256))])])])}}}),ut={class:"flex h-fit max-h-full flex-col overflow-hidden"},pt={class:"text-md mb-3 flex-none font-bold"},ft={class:"h-full w-full flex-1 overflow-y-auto rounded border bg-white"},mt={class:"w-2/5 truncate text-sm font-medium"},_t=["innerHTML"],ht=["tooltip","innerHTML"],xt={key:2,class:"line-clamp-2 flex-1 text-sm"},vt=["innerHTML"],bt=U({__name:"im-parameters",props:{data:{}},setup(T){const $=T;function p(u){return u?'<div class="i-carbon/checkmark-outline text-green-600" v-if="cell">✓</div>':'<div class="i-carbon/close-outline text-red-600" v-else>✗</div>'}const h=M(()=>{var _,s;const u=$.data;return[{type:"priority",label:"Priority",data:u.priority},{type:"person",label:"Owner",data:u.owner??"-"},{type:"text",label:"Business Date",data:(_=u.parameters)==null?void 0:_.businessDate},{type:"text",label:"Run time",data:u.createdAt},{type:"text",label:"Name",data:(s=u.info)==null?void 0:s.fund.name}]});return(u,m)=>{const _=ee,s=te;return o(),i("div",ut,[e("h2",pt,c(u.t.parameters),1),e("div",ft,[(o(!0),i(z,null,A(l(h),(a,w)=>(o(),i("section",{class:"flex px-4 py-2 odd:bg-white even:bg-stone-100",key:`param-${w}`},[e("div",mt,c(a.label),1),a.label==="Language"?(o(),i("div",{key:0,class:"flex1 text-sm",innerHTML:a.data},null,8,_t)):a.label==="Document"?(o(),i("div",{key:1,tooltip:a.data[0],class:"flex1 text-sm",innerHTML:a.data[1]},null,8,ht)):a.type==="text"?(o(),i("div",xt,c(a.data),1)):a.type==="check"?(o(),i("div",{key:3,class:"flex-1 text-sm",innerHTML:p(a.data)},null,8,vt)):b("",!0),a.type==="priority"?(o(),D(_,{key:4,data:u.data},null,8,["data"])):b("",!0),a.type==="person"?(o(),D(s,{key:5,data:u.data},null,8,["data"])):b("",!0)]))),128))])])}}}),gt={class:"flex flex-none flex-col items-center justify-between gap-3 md:flex-row"},wt={class:"flex flex-col"},yt={class:"truncate text-3xl font-black"},$t={class:"-mb-2 text-lg/tight text-stone-700"},kt={key:0,class:"@[1048px]:grid-cols-4 grid grid-flow-col flex-1 grid-cols-3 gap-5 overflow-hidden"},Ct=U({__name:"1+run",setup(T){const{data:$}=Y("runs"),p=M(()=>$.value.find(h=>h.id===+$route.params.id));return(h,u)=>{const m=Be,_=Ve,s=ct,a=bt,w=se;return o(),D(w,{class:"@container"},{header:H(()=>[e("div",gt,[e("div",wt,[e("h1",yt,"Run "+c((h._.provides[X]||h.$route).params.id),1),e("h2",$t,c(l(p)?l(p).workflow.name:"Loading ..."),1)])])]),default:H(()=>[l(p)?(o(),i("div",kt,[B(m,{class:"row-span-2",data:l(p)},null,8,["data"]),B(_,{class:"row-span-2",data:l(p)},null,8,["data"]),B(s,{class:"@[1048px]:row-span-2",data:l(p)},null,8,["data"]),B(a,{class:"@[1048px]:row-span-2",data:l(p)},null,8,["data"])])):b("",!0)]),_:1})}}});export{Ct as default};
