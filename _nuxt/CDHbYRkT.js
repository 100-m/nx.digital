import{f as D,r as j,p as x,D as F,h as T,w as g,o as c,b as w,d as L,a as p,i as u,c as m,q as M,F as N,n as z,s as A,t as O,k as P,A as R,m as U}from"./BJUyEi7U.js";import W from"./DHWzuOHt.js";import{_ as I}from"./B_6uN8ho.js";import{_ as K}from"./CiweJmm9.js";import G from"./CcEWNqtA.js";import"./qhOtPnIg.js";const H={class:"ml-1 flex !h-7 items-center"},J={class:"flex gap-4 overflow-auto"},Q=["tooltip","onClick"],X=["tooltip","onClick"],Y={class:"m-auto truncate text-md font-semibold"},Z={key:0,"nx-cell":"",class:"ml-auto truncate px-2 tabular-nums"},at=D({__name:"9-finder",setup(tt){const d=j({}),a=x(()=>$route.query.path||""),V=x(()=>`ROOT${a.value?".":""}${a.value}`.split(".").map((l,n,_)=>{var o;return{label:((o=C.value[n-1])==null?void 0:o.options.type)??l,to:{query:{path:_.slice(1,n+1).join(".")}}}})),C=x(()=>{const l=a.value.split("."),n=G.filter(o=>o.id.split(".").slice(0,-1).every((r,s)=>d.value[s]||r===l[s]));return Object.values(n.group(o=>o.id.split(".").length)).map((o,r)=>{var v;const s=o,t=(v=s[0])==null?void 0:v.type,i=s.reduce((e,f)=>e+(f.EMV??0),0);s.forEach(e=>{e.weight=e.EMV/i,e.total=i});const b={actions:[],columns:[{key:"name",label:"Name",type:"string",width:190},{key:"weight",label:"%",type:"percent",width:70}],sortBy:["%"],showCheckbox:!1,storeKey:t,type:t,level:r};return setTimeout(()=>$(".overflow-auto.gap-4").scroll(1e4,0),100),{data:s,options:b,onState:h};function h(e){var f;a.value&&e.selection.restoreSelectionItems([(f=s.find(E=>E.id.split(".")[r]===a.value.split(".")[r]))==null?void 0:f.id]),F(()=>e.selection.items.list,()=>{setTimeout(()=>{var B;if(!((B=e.ref)!=null&&B.contains(document.activeElement)))return;const y=e.selection.items.list.map(k=>{var S;return(S=e.dataMap.map[k])==null?void 0:S._data}).filter(k=>k).at(-1);if(!y)return $router.push({query:{path:a.value.split(".").slice(0,r).join(".")}});a.value!==y.id&&$router.push({query:{path:y.id}})})},{deep:!0})}})});function q(){Object.keys(localStorage).filter(l=>l.startsWith("grid-")).forEach(l=>delete localStorage[l]),location.reload()}return(l,n)=>{const _=U,o=W,r=I,s=K;return c(),T(s,null,{default:g(()=>[w(_,{color:"red",class:"fixed right-0 top-0 rounded-none",onClick:q},{default:g(()=>n[0]||(n[0]=[L("CLEAR")])),_:1}),p("div",H,[w(o,{links:u(V)},null,8,["links"])]),p("div",J,[(c(!0),m(N,null,M(u(C),t=>(c(),m(N,{key:t.options.level},[u(d)[t.options.level]?(c(),m("div",{key:0,class:"i-carbon/right-panel-close -mx-2 -mt-px h-7 cursor-pointer",tooltip:`OPEN ${t.options.type}`,onClick:i=>u(d)[t.options.level]=!1},null,8,Q)):(c(),m("div",{key:1,style:z({minWidth:t.options.columns.sum("width")+"px"})},[p("div",{class:A(["group flex h-7 cursor-pointer select-none items-center border-b-2 border-b-primary",t.options.level===0&&"pointer-events-none"]),tooltip:`CLOSE ${t.options.type}`,onClick:i=>u(d)[t.options.level]=!0},[p("div",Y,O(t.options.type),1),n[1]||(n[1]=p("div",{class:"i-carbon/right-panel-open invisible group-hover:visible"},null,-1))],10,X),w(r,R({class:"h-[calc(100vh-200px)] overflow-auto",ref_for:!0},t),{cell:g(({cell:i,row:b,header:h,view:v})=>[h.metadata.type==="percent"?(c(),m("div",Z,O(i.format("en",{style:"percent",minimumFractionDigits:0,maximumFractionDigits:2})),1)):P("",!0)]),_:2},1040)],4))],64))),128))])]),_:1})}}});export{at as default};
